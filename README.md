# querybm

[![CI](https://github.com/tecowl/querybm/actions/workflows/ci.yml/badge.svg)](https://github.com/tecowl/querybm/actions/workflows/ci.yml)
[![codecov](https://codecov.io/gh/tecowl/querybm/graph/badge.svg?token=1KIHO6LA3D)](https://codecov.io/gh/tecowl/querybm)
[![Go Report Card](https://goreportcard.com/badge/github.com/tecowl/querybm)](https://goreportcard.com/report/github.com/tecowl/querybm)
[![Go project version](https://badge.fury.io/go/github.com%2Ftecowl%2Fquerybm.svg)](https://badge.fury.io/go/github.com%2Ftecowl%2Fquerybm)
[![Enabled Linters](https://img.shields.io/badge/dynamic/yaml?url=https%3A%2F%2Fraw.githubusercontent.com%2Ftecowl%2Fquerybm%2Frefs%2Fheads%2Fmain%2F.project.yaml&query=%24.linters&label=enabled%20linters&color=%2317AFC2)](.golangci.yml)
[![Documentation](https://img.shields.io/badge/go.dev-reference-007d9c?logo=go&logoColor=white&style=flat-square)](https://pkg.go.dev/github.com/tecowl/querybm)
![GitHub go.mod Go version](https://img.shields.io/github/go-mod/go-version/tecowl/querybm)
![GitHub License](https://img.shields.io/github/license/tecowl/querybm)

A simple SQL query builder and mapper. `querybm` works well with models generated by [sqlc](https://sqlc.dev/). But it works with your models without sqlc.

## FEATURES

- [x] No dependencies
- [x] Build SELECT statement dynamically with struct type
- [x] Mapping with generics instead of reflection
- [x] 100% test coverage

See [godoc](https://pkg.go.dev/github.com/tecowl/querybm) for more details.

## INSTALL

```sh
go get -u github.com/tecowl/querybm
```

## USAGE

```go
// You can use model generated by sqlc instead of defining your own
type Author struct {
	AuthorID int32
	Name     string
}

type Condition struct {
	Name string
}

func (c *Condition) Build(s *querybm.Statement) {
	if c.Name != "" {
		s.Where.Add(Field("name", LikeContains(c.Name)))
	}
}

func New(db *sql.DB, condition *Condition) *querybm.Query[Author] {
	return querybm.New(
		db,
		"authors",
		querybm.NewFields(
			[]string{"author_id", "name"},
			func(rows querybm.Scanner, author *models.Author) error {
				return rows.Scan(&author.AuthorID, &author.Name)
			},
		),
		condition,
		querybm.NewSortItem("name", false),
		querybm.NewLimitOffset(100, 0),
	)
}

func main() {
    db, _ := sql.Open("..", "...")
    defer db.Close()

    condition := &Condition{Name: "John"}
    q := New(db, condition)

  	cnt, _ := q.Count(ctx)
    list, _ := q.List(ctx)
}
```

## EXAMPLES

- [Simple Dynamic Query](./tests/mysql/queries/authors/)
- [Query with enumerations](./tests/mysql/queries/books_with_enum/)
- [Query with range](./tests/mysql/queries/books_with_range/)
- [Query with INNER JOIN](./tests/mysql/queries/books_with_inner_join/)
- Query with OUTER JOIN

## TESTS

- [MySQL](./tests/mysql/)
- PostgreSQL
- SQLite3

## LICENSE

[MIT](./LICENSE)
